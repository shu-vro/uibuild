"use server";

import { revalidatePath } from "next/cache";
import { v2 } from "cloudinary";

const cloudinary = v2;

cloudinary.config({
    api_key: process.env.CLOUDINARY_API_KEY,
    api_secret: process.env.CLOUDINARY_API_SECRET,
    cloud_name: process.env.CLOUDINARY_CLOUD_NAME,
    secure: true,
});

export async function saveVersionAction(formData: FormData) {
    try {
        const file =
            "data:text/plain;base64,IyBUcnV0aCB0YWJsZQojIEdlbmVyYXRlZCBmcm9tIGNpcmN1aXQgbWFpbgojIEV4cG9ydGVkIG9uIFN1biBGZWIgMTYgMDg6NTk6NDAgQkRUIDIwMjUKCiMgSGludHMgYW5kIE5vdGVzIG9uIEZvcm1hdHRpbmc6CiMgKiBZb3UgY2FuIGVkaXQgdGhpcyBmaWxlIHRoZW4gaW1wb3J0IGl0IGJhY2sgaW50byBMb2dpc2ltIQojICogQW55dGhpbmcgYWZ0ZXIgYSAnIycgaXMgYSBjb21tZW50IGFuZCB3aWxsIGJlIGlnbm9yZWQuCiMgKiBCbGFuayBsaW5lcyBhbmQgc2VwYXJhdG9yIGxpbmVzIChlLmcuLCB+fn5+fn4pIGFyZSBpZ25vcmVkLgojICogS2VlcCBjb2x1bW4gbmFtZXMgc2ltcGxlIChubyBzcGFjZXMsIHB1bmN0dWF0aW9uLCBldGMuKQojICogJ05hbWVbTi4uMF0nIGluZGljYXRlcyBhbiBOKzEgYml0IHZhcmlhYmxlLCB3aGVyZWFzCiMgICAnTmFtZScgYnkgaXRzZWxmIGluZGljYXRlcyBhIDEtYml0IHZhcmlhYmxlLgojICogWW91IGNhbiB1c2UgJ3gnIG9yICctJyB0byBpbmRpY2F0ZSAiZG9uJ3QgY2FyZSIgZm9yIGJvdGgKIyAgIGlucHV0IGFuZCBvdXRwdXQgYml0cy4KIyAqIFlvdSBjYW4gdXNlIGJpbmFyeSAoZS5nLiwgJzEwMTAwMDExeHh4eCcpIG5vdGF0aW9uIG9yCiMgICBvciBoZXggKGUuZy4sICdDM3gnKS4gTG9naXNpbSB3aWxsIGZpZ3VyZSBvdXQgd2hpY2ggaXMgd2hpY2guCgphMiBhMSBhMCBiMiBiMSBiMCB8IHMzIHMyIHMxIHMwCn5+fn5+fn5+fn5+fn5+fn5+fn5+fn5+fn5+fn5+fn4KMCAgMCAgMCAgMCAgMCAgMCAgfCAwICAwICAwICAwIAowICAwICAwICAwICAwICAxICB8IDAgIDAgIDAgIDEgCjAgIDAgIDAgIDAgIDEgIDAgIHwgMCAgMCAgMSAgMCAKMCAgMCAgMCAgMCAgMSAgMSAgfCAwICAwICAxICAxIAowICAwICAwICAxICAwICAwICB8IDAgIDEgIDAgIDAgCjAgIDAgIDAgIDEgIDAgIDEgIHwgMCAgMSAgMCAgMSAKMCAgMCAgMCAgMSAgMSAgMCAgfCAwICAxICAxICAwIAowICAwICAwICAxICAxICAxICB8IDAgIDEgIDEgIDEgCjAgIDAgIDEgIDAgIDAgIDAgIHwgMCAgMCAgMCAgMSAKMCAgMCAgMSAgMCAgMCAgMSAgfCAwICAwICAxICAwIAowICAwICAxICAwICAxICAwICB8IDAgIDAgIDEgIDEgCjAgIDAgIDEgIDAgIDEgIDEgIHwgMCAgMSAgMCAgMCAKMCAgMCAgMSAgMSAgMCAgMCAgfCAwICAxICAwICAxIAowICAwICAxICAxICAwICAxICB8IDAgIDEgIDEgIDAgCjAgIDAgIDEgIDEgIDEgIDAgIHwgMCAgMSAgMSAgMSAKMCAgMCAgMSAgMSAgMSAgMSAgfCAxICAwICAwICAwIAowICAxICAwICAwICAwICAwICB8IDAgIDAgIDEgIDAgCjAgIDEgIDAgIDAgIDAgIDEgIHwgMCAgMCAgMSAgMSAKMCAgMSAgMCAgMCAgMSAgMCAgfCAwICAxICAwICAwIAowICAxICAwICAwICAxICAxICB8IDAgIDEgIDAgIDEgCjAgIDEgIDAgIDEgIDAgIDAgIHwgMCAgMSAgMSAgMCAKMCAgMSAgMCAgMSAgMCAgMSAgfCAwICAxICAxICAxIAowICAxICAwICAxICAxICAwICB8IDEgIDAgIDAgIDAgCjAgIDEgIDAgIDEgIDEgIDEgIHwgMSAgMCAgMCAgMSAKMCAgMSAgMSAgMCAgMCAgMCAgfCAwICAwICAxICAxIAowICAxICAxICAwICAwICAxICB8IDAgIDEgIDAgIDAgCjAgIDEgIDEgIDAgIDEgIDAgIHwgMCAgMSAgMCAgMSAKMCAgMSAgMSAgMCAgMSAgMSAgfCAwICAxICAxICAwIAowICAxICAxICAxICAwICAwICB8IDAgIDEgIDEgIDEgCjAgIDEgIDEgIDEgIDAgIDEgIHwgMSAgMCAgMCAgMCAKMCAgMSAgMSAgMSAgMSAgMCAgfCAxICAwICAwICAxIAowICAxICAxICAxICAxICAxICB8IDEgIDAgIDEgIDAgCjEgIDAgIDAgIDAgIDAgIDAgIHwgMCAgMSAgMCAgMCAKMSAgMCAgMCAgMCAgMCAgMSAgfCAwICAxICAwICAxIAoxICAwICAwICAwICAxICAwICB8IDAgIDEgIDEgIDAgCjEgIDAgIDAgIDAgIDEgIDEgIHwgMCAgMSAgMSAgMSAKMSAgMCAgMCAgMSAgMCAgMCAgfCAxICAwICAwICAwIAoxICAwICAwICAxICAwICAxICB8IDEgIDAgIDAgIDEgCjEgIDAgIDAgIDEgIDEgIDAgIHwgMSAgMCAgMSAgMCAKMSAgMCAgMCAgMSAgMSAgMSAgfCAxICAwICAxICAxIAoxICAwICAxICAwICAwICAwICB8IDAgIDEgIDAgIDEgCjEgIDAgIDEgIDAgIDAgIDEgIHwgMCAgMSAgMSAgMCAKMSAgMCAgMSAgMCAgMSAgMCAgfCAwICAxICAxICAxIAoxICAwICAxICAwICAxICAxICB8IDEgIDAgIDAgIDAgCjEgIDAgIDEgIDEgIDAgIDAgIHwgMSAgMCAgMCAgMSAKMSAgMCAgMSAgMSAgMCAgMSAgfCAxICAwICAxICAwIAoxICAwICAxICAxICAxICAwICB8IDEgIDAgIDEgIDEgCjEgIDAgIDEgIDEgIDEgIDEgIHwgMSAgMSAgMCAgMCAKMSAgMSAgMCAgMCAgMCAgMCAgfCAwICAxICAxICAwIAoxICAxICAwICAwICAwICAxICB8IDAgIDEgIDEgIDEgCjEgIDEgIDAgIDAgIDEgIDAgIHwgMSAgMCAgMCAgMCAKMSAgMSAgMCAgMCAgMSAgMSAgfCAxICAwICAwICAxIAoxICAxICAwICAxICAwICAwICB8IDEgIDAgIDEgIDAgCjEgIDEgIDAgIDEgIDAgIDEgIHwgMSAgMCAgMSAgMSAKMSAgMSAgMCAgMSAgMSAgMCAgfCAxICAxICAwICAwIAoxICAxICAwICAxICAxICAxICB8IDEgIDEgIDAgIDEgCjEgIDEgIDEgIDAgIDAgIDAgIHwgMCAgMSAgMSAgMSAKMSAgMSAgMSAgMCAgMCAgMSAgfCAxICAwICAwICAwIAoxICAxICAxICAwICAxICAwICB8IDEgIDAgIDAgIDEgCjEgIDEgIDEgIDAgIDEgIDEgIHwgMSAgMCAgMSAgMCAKMSAgMSAgMSAgMSAgMCAgMCAgfCAxICAwICAxICAxIAoxICAxICAxICAxICAwICAxICB8IDEgIDEgIDAgIDAgCjEgIDEgIDEgIDEgIDEgIDAgIHwgMSAgMSAgMCAgMSAKMSAgMSAgMSAgMSAgMSAgMSAgfCAxICAxICAxICAwIAo=";

        const uploadResult = await cloudinary.uploader
            .upload(file, {
                use_filename: true,
                unique_filename: true,
                exif: false,
                asset_folder: "uibuild-data",
                resource_type: "raw",
                type: "upload",
                format: "txt",
            })
            .catch((error) => {
                console.log(error);
            });

        console.log(uploadResult);
    } catch (error) {
        return error;
    } finally {
        revalidatePath("/");
    }
}
